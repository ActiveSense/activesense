<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             Width="850"
             MaxHeight="800"
             xmlns:viewModels="clr-namespace:ActiveSense.Desktop.ViewModels"
             x:DataType="viewModels:ProcessDialogViewModel"
             xmlns:ui="clr-namespace:FluentAvalonia.UI.Controls;assembly=FluentAvalonia"
             x:Class="ActiveSense.Desktop.Views.ProcessDialogView">

    <Design.DataContext>
        <viewModels:ProcessDialogViewModel />
    </Design.DataContext>

    <UserControl.Styles>
        <Style Selector="Border.card">
            <Setter Property="CornerRadius" Value="8" />
            <Setter Property="Background" Value="White" />
            <Setter Property="BorderBrush" Value="#E5E5E5" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Margin" Value="0,0,0,12" />
            <Setter Property="Padding" Value="12" />
        </Style>

        <Style Selector="TextBlock.heading">
            <Setter Property="FontSize" Value="24" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Margin" Value="0,0,0,8" />
        </Style>

        <Style Selector="TextBlock.subheading">
            <Setter Property="FontSize" Value="13" />
            <Setter Property="FontWeight" Value="Medium" />
            <Setter Property="Margin" Value="0,0,0,6" />
        </Style>

        <Style Selector="TextBlock.subtitle">
            <Setter Property="FontSize" Value="16" />
            <Setter Property="Opacity" Value="0.6" />
            <Setter Property="Margin" Value="0,4,0,20" />
        </Style>

        <Style Selector="Button.action">
            <Setter Property="Background" Value="White" />
            <Setter Property="Foreground" Value="Black" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="BorderBrush" Value="#E5E5E5" />
            <Setter Property="CornerRadius" Value="20" />
            <Setter Property="Padding" Value="16,10" />
            <Setter Property="HorizontalContentAlignment" Value="Center" />
            <Setter Property="VerticalContentAlignment" Value="Center" />
            <Setter Property="MinWidth" Value="150" />
        </Style>

        <Style Selector="Button.action:pointerover">
            <Setter Property="Background" Value="#F5F5F5" />
        </Style>

        <Style Selector="Button.primary">
            <Setter Property="Background" Value="#0078D4" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="CornerRadius" Value="20" />
            <Setter Property="Padding" Value="16,10" />
            <Setter Property="HorizontalContentAlignment" Value="Center" />
            <Setter Property="VerticalContentAlignment" Value="Center" />
            <Setter Property="MinWidth" Value="150" />
        </Style>

        <Style Selector="Button.primary:pointerover">
            <Setter Property="Background" Value="#106EBE" />
        </Style>
    </UserControl.Styles>

    <Border
        CornerRadius="16"
        BorderThickness="0"
        Background="#F0F6F9"
        BoxShadow="0 4 24 0 #20000000">
        <Grid RowDefinitions="Auto, *, Auto">
            <!-- Header -->
            <Grid Grid.Row="0"
                  Margin="24,24,24,0">

                <StackPanel>
                    <TextBlock Text="{Binding Title, FallbackValue='Add more files'}"
                               Classes="heading" />
                    <TextBlock Text="Sensordaten analysieren."
                               Classes="subtitle" />
                </StackPanel>

                <Button HorizontalAlignment="Right"
                        VerticalAlignment="Top"
                        Background="Transparent"
                        BorderThickness="0"
                        Command="{Binding CancelCommand}"
                        Padding="8">
                    <ui:SymbolIcon Symbol="Dismiss" FontSize="16" />
                </Button>
            </Grid>

            <!-- Content -->
            <ScrollViewer Grid.Row="1"
                          Padding="24,0,24,0"
                          VerticalScrollBarVisibility="Auto">
                <Grid ColumnDefinitions="*, 16, Auto">
                    <!-- Left column - Settings -->
                    <StackPanel Grid.Column="0" Spacing="12">
                        <Border Classes="card">
                            <StackPanel Spacing="8">
                                <TextBlock Classes="subheading">Processing Settings</TextBlock>

                                <ui:SettingsExpander Header="Sedentary Threshold"
                                                     >
                                    <ui:SettingsExpander.Footer>
                                        <ui:NumberBox Value="6.2"
                                                      SimpleNumberFormat="F2"
                                                      ValidationMode="InvalidInputOverwritten"
                                                      SpinButtonPlacementMode="Compact"
                                                      SmallChange="0.1"
                                                      Width="120" />
                                    </ui:SettingsExpander.Footer>
                                </ui:SettingsExpander>

                                <ui:SettingsExpander Header="Light Threshold"
                                                     >
                                    <ui:SettingsExpander.Footer>
                                        <ui:NumberBox Value="3.4"
                                                      SimpleNumberFormat="F2"
                                                      ValidationMode="InvalidInputOverwritten"
                                                      SpinButtonPlacementMode="Compact"
                                                      SmallChange="0.1"
                                                      Width="120" />
                                    </ui:SettingsExpander.Footer>
                                </ui:SettingsExpander>
                                
                                <ui:SettingsExpander Header="Medium Threshold"
                                                    >
                                    <ui:SettingsExpander.Footer>
                                        <ui:NumberBox Value="3.4"
                                                      SimpleNumberFormat="F2"
                                                      ValidationMode="InvalidInputOverwritten"
                                                      SpinButtonPlacementMode="Compact"
                                                      SmallChange="0.1"
                                                      Width="120" />
                                    </ui:SettingsExpander.Footer>
                                </ui:SettingsExpander>
                                
                                <ui:SettingsExpander Header="Vigorous Threshold"
                                                   >
                                    <ui:SettingsExpander.Footer>
                                        <ui:NumberBox Value="3.4"
                                                      SimpleNumberFormat="F2"
                                                      ValidationMode="InvalidInputOverwritten"
                                                      SpinButtonPlacementMode="Compact"
                                                      SmallChange="0.1"
                                                      Width="120" />
                                    </ui:SettingsExpander.Footer>
                                </ui:SettingsExpander>
                            </StackPanel>
                        </Border>

                        <Border Classes="card">
                            <StackPanel Spacing="12">
                                <TextBlock Classes="subheading">Analysis Status</TextBlock>
                                <TextBlock Text="{Binding StatusMessage, FallbackValue='Ready to process files'}"
                                           TextWrapping="Wrap" />
                            </StackPanel>
                        </Border>
                        <Border Classes="card">
                            <StackPanel Spacing="12">
                                <TextBlock Classes="subheading">Analysis Output</TextBlock>
                                <ScrollViewer>

                                    <TextBox Text="{Binding ScriptOutput, FallbackValue='Waiting'}" />
                                </ScrollViewer>
                            </StackPanel>
                        </Border>
                    </StackPanel>

                    <!-- Separator -->
                    <Rectangle Grid.Column="1" Fill="Transparent" />

                    <!-- Right column - File selection -->
                    <Border Grid.Column="2"
                            Classes="card"
                            Width="240"
                            VerticalAlignment="Top">
                        <Grid RowDefinitions="Auto, *, Auto">
                            <TextBlock Grid.Row="0"
                                       Text="Selected Files"
                                       Classes="subheading" />

                            <Border Grid.Row="1"
                                    CornerRadius="6"
                                    Padding="6"
                                    MinHeight="200"
                                    MaxHeight="280">
                                <ListBox ItemsSource="{Binding SelectedFiles}"
                                         Background="Transparent"
                                         Padding="0">
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <Grid ColumnDefinitions="Auto, *" Margin="0,3">
                                                <ui:SymbolIcon Grid.Column="0"
                                                               Symbol="Document"
                                                               FontSize="14"
                                                               Margin="0,0,6,0"
                                                               VerticalAlignment="Center" />
                                                <TextBlock Grid.Column="1"
                                                           Text="{Binding}"
                                                           TextWrapping="Wrap"
                                                           FontSize="12"
                                                           VerticalAlignment="Center" />
                                            </Grid>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>
                            </Border>

                            <Button Grid.Row="2"
                                    Name="OpenFileButton"
                                    HorizontalAlignment="Stretch"
                                    HorizontalContentAlignment="Center"
                                    Margin="0,8,0,0"
                                    Classes="action">
                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <ui:SymbolIcon Symbol="Folder" FontSize="14" />
                                    <TextBlock>Select Files</TextBlock>
                                </StackPanel>
                            </Button>
                        </Grid>
                    </Border>
                </Grid>
            </ScrollViewer>

            <!-- Footer -->
            <Grid Grid.Row="2"
                  Margin="24,20"
                  ColumnDefinitions="Auto, *, Auto">

                <TextBlock Grid.Column="1"
                           Text="or"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           Opacity="0.6"
                           FontSize="16" />

                <Button Grid.Column="0"
                        Classes="action"
                        HorizontalAlignment="Left"
                        Command="{Binding CancelCommand}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <TextBlock>Abbrechen</TextBlock>
                    </StackPanel>
                </Button>

                <Button Grid.Column="2"
                        Classes="primary"
                        Command="{Binding ProcessFilesCommand}"
                        HorizontalAlignment="Right">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <ui:SymbolIcon Symbol="Play" FontSize="16" />
                        <TextBlock>Analyse Starten</TextBlock>
                    </StackPanel>
                </Button>
            </Grid>
        </Grid>
    </Border>
</UserControl>