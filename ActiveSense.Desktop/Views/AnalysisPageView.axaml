<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:viewModels="clr-namespace:ActiveSense.Desktop.ViewModels"
             xmlns:models="clr-namespace:ActiveSense.Desktop.Models"
             xmlns:ui="clr-namespace:FluentAvalonia.UI.Controls;assembly=FluentAvalonia"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="ActiveSense.Desktop.Views.AnalysisPageView"
             x:DataType="viewModels:AnalysisPageViewModel">

    <UserControl.Styles>
        <Style Selector="Border.card">
            <Setter Property="CornerRadius" Value="8" />
            <Setter Property="BoxShadow" Value="0 2 8 0 #15000000" />
            <Setter Property="Padding" Value="16" />
            <Setter Property="Margin" Value="0,0,0,16" />
        </Style>

        <Style Selector="TextBlock.heading">
            <Setter Property="FontSize" Value="16" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Margin" Value="0,0,0,12" />
        </Style>

        <Style Selector="ListBox">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="Padding" Value="0" />
        </Style>
    </UserControl.Styles>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Tab buttons using RadioButtonGroup style -->
        <Border Grid.Row="0"
                Margin="0,0,0,16"
                HorizontalAlignment="Left"
                Theme="{StaticResource RadioButtonGroupBorder}">
            <ListBox Name="tabSelector"
                     Theme="{StaticResource ButtonRadioGroupListBox}"
                     ItemsSource="{Binding TabItems}"
                     SelectedItem="{Binding SelectedTabItem}"
                     DisplayMemberBinding="{Binding Name}">
            </ListBox>
        </Border>

        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <!-- Main content area - will resize when expander changes -->
                <ColumnDefinition Width="*" />
                <!-- Expander area - will use as much space as needed -->
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <!-- Main content area -->
            <Border Classes="card" Grid.Column="0">
                <ContentControl Content="{Binding SelectedTabItem.Page}" />
            </Border>

            <!-- Expander with file selection -->
            <Border Grid.Column="1">
                <Expander
                    ExpandDirection="Left"
                    Header="Files"
                    Margin="8,0,0,0"
                    MinWidth="50">
                    <Border
                        Margin="0">
                        <Grid RowDefinitions="Auto, *">
                            <Border Grid.Row="1"
                                    CornerRadius="4"
                                    Padding="8">
                                <ListBox ItemsSource="{Binding ResultFiles}"
                                         SelectionMode="Multiple,Toggle"
                                         SelectionChanged="OnSelectionChanged"
                                         Theme="{DynamicResource CheckGroupListBox}"
                                         MinHeight="300"
                                         MaxWidth="300">
                                    <!-- Ensure proper ItemsPanel for vertical layout -->
                                    <ListBox.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <StackPanel Orientation="Vertical" />
                                        </ItemsPanelTemplate>
                                    </ListBox.ItemsPanel>

                                    <ListBox.ItemTemplate>
                                        <DataTemplate x:DataType="models:Analysis">
                                            <TextBlock Text="{Binding FileName}"
                                                       TextWrapping="Wrap"
                                                       VerticalAlignment="Center"
                                                       Margin="4" />
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>
                            </Border>
                        </Grid>
                    </Border>
                </Expander>
            </Border>
        </Grid>

        <Grid IsVisible="{Binding ShowSpinner}"
              Grid.Row="1"
              HorizontalAlignment="Center"
              VerticalAlignment="Center">
            <Border Background="#80FFFFFF"
                    CornerRadius="8"
                    Padding="24"
                    BoxShadow="0 4 16 0 #20000000">
                <StackPanel Spacing="12">
                    <ui:ProgressRing Width="48"
                                     Height="48"
                                     IsIndeterminate="True"
                                     HorizontalAlignment="Center" />
                    <TextBlock Text="Daten werden geladen..."
                               HorizontalAlignment="Center"
                               FontWeight="Medium" />
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</UserControl>